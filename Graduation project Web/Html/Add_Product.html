<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>إضافة منتج جديد</title>
  <link rel="stylesheet" href="../css/style-addproduct.css">
</head>
<body>
  <div class="form-container">
    <h2>إضافة منتج جديد</h2>
    <form id="addProductForm">
      <label for="name">اسم المنتج</label>
      <input type="text" id="name" name="name" required>

      <label for="price">السعر ($)</label>
      <input type="number" id="price" name="price" required min="0.01" step="0.01">

      <label for="category">الفئة</label>
      <select id="category" name="category" required>
        <option value="">اختر فئة</option>
        <option>إلكترونيات</option>
        <option>ملابس</option>
        <option>أثاث</option>
        <option>كتب</option>
      </select>

      <label for="description">وصف المنتج</label>
      <textarea id="description" name="description" rows="4"></textarea>

      <label for="image">صورة المنتج</label>
      <input type="file" id="image" name="image" accept="image/*" required>

      <button type="submit">إضافة المنتج</button>
    </form>
  </div>

<script type="module">
  import { db } from "../js/firebase.js";
  import { collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

  const form = document.getElementById("addProductForm");
  const imgbbAPIKey = "9514c90de1a0b07a6020c180823cde84";

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const name = form.name.value.trim();
    const price = parseFloat(form.price.value);
    const category = form.category.value;
    const description = form.description.value.trim();
    const imageFile = form.image.files[0];

    if (!name || !price || !category || !imageFile) {
      return alert("يرجى ملء جميع الحقول المطلوبة، بما في ذلك الصورة.");
    }

    try {
  
      const formData = new FormData();
      formData.append("image", imageFile);

      const uploadRes = await fetch(`https://api.imgbb.com/1/upload?key=${imgbbAPIKey}`, {
        method: "POST",
        body: formData,
      });

      const uploadData = await uploadRes.json();

      if (!uploadData.success) throw new Error("فشل في رفع الصورة إلى ImgBB");

      const imageUrl = uploadData.data.url;

   
      await addDoc(collection(db, "products"), {
        name,
        price,
        category,
        description,
        image: imageUrl,
        createdAt: serverTimestamp()
      });

      form.reset();
      alert("✅ تمت إضافة المنتج بنجاح!");
    } catch (error) {
      console.error("❌ خطأ أثناء إضافة المنتج:", error);
      alert("حدث خطأ أثناء إضافة المنتج: " + error.message);
    }
  });
</script>

</body>
</html>
